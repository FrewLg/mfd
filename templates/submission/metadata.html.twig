{% extends 'base.html.twig' %}
{% block title %}Submission
{% endblock %}
{% block body_title %}Submission
{% endblock %}
{% block container_title %}New submission
{% endblock %}

{% block help_right %}
	{% include "helps/submission_help.html.twig" %}

{% endblock %}
{% block pagehead %}New submission
{% endblock %}
{% block breadcrumb %}
	<li class="breadcrumb-item active">New submission</li>
{% endblock %}
{% macro displayBudget(budget) %}
	{# {{form_row(vitalSignTestResult)}} #}

	<div class="col-md-2">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">Expense type</label>
			{{form_widget(budget.category)}}

		</div>
	</div>

	<div class="col-md-4">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">Description</label>
			{{form_widget(budget.description)}}

		</div>
	</div>

	<div class="col-md-2">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">Cost</label>
			{{form_widget(budget.cost)}}

		</div>
	</div>
	<div class="col-md-1">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">Quantity</label>
			{{form_widget(budget.quantity)}}

		</div>
	</div>

	<div class="col-md-1">
		<div class="form-group">

			<button type="button" data-limit="1" class=" btn btn-danger btn-sm close  remove-collection-widget mt-4   bgc-h-danger-l2 radius-round ">
				<span aria-hidden="true">×</span>

			</button>
		</div>
	</div>

{% endmacro %}

{% macro researchTime(researchTimeTable) %}
	<div class="col-md-4">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">Task in milestones </label>
			{{form_widget(researchTimeTable.task)}}
		</div>
	</div>
	<div class="col-md-3">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">Task  starting date</label>
			{{form_widget(researchTimeTable.date_start)}}
		</div>
	</div>
	<div class="col-md-3">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">Task accomplished due date</label>
			{{form_widget(researchTimeTable.date_end)}}
		</div>
	</div>
	<div class="col-md-1">
		<div class="form-group">
			<button type="button" data-limit="1" class=" btn btn-danger btn-sm close  remove-collection-widget mt-4   bgc-h-danger-l2 radius-round ">
				<span aria-hidden="true">×</span>
			</button>
		</div>
	</div>

{% endmacro %}

{% macro displayAttachement(attachement) %}
	
	<div class="col-md-2">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">Type</label>
			{{form_widget(attachement.name)}}

		</div>
	</div>
	<div class="col-md-3">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">Attachement</label>
			{{form_widget(attachement.imageFile)}}

		</div>
	</div>

<div class="col-md-1">
		<div class="form-group">

			 
		</div>
	</div>
	<div class="col-md-2">
		<div class="form-group">

			<button type="button" class=" btn btn-danger btn-sm close  remove-collection-widget mt-4   bgc-h-danger-l2 radius-round ">
				<span aria-hidden="true">×</span>

			</button>
		</div>
	</div>


{% endmacro %}

{% macro displayAttachement2(attachement) %}
	
	<div class="row">
	{# <div class="card-body"> #}
	<div class="col-md-2">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">Type</label>
			<div>{{attachement.vars.value.name}}
			</div>

		</div>
		<div class="d-none">{{form_widget(attachement)}}</div>
	</div>

	<div class="col-md-4">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">Attachement</label>
			<a class="form-control btn btn-xs btn-outline-primary" href="{{ asset('uploads/submission/' ~ attachement.vars.value.file) }}">Download {{attachement.vars.value.name}}</a>

		</div>
	</div>

{# {% if attachement.vars.value.file %}
 =

{% endif %} #}


	<div class="col-md-1">
		<div class="form-group">

			<button type="button" class=" btn btn-danger btn-sm close  remove-collection-widget mt-4   bgc-h-danger-l2 radius-round ">
				<span aria-hidden="true">×</span>

			</button>
		</div>
	</div> 
	 </div>
	 </div>
	 

{% endmacro %} 

{% macro displayObjective(objective) %}
	<div class="col-md-11">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">Specific objective</label>
			{{form_widget(objective.objective)}}

		</div>
	</div>


	<div class="col-md-1">
		<div class="form-group">

			<button type="button" class=" btn btn-danger btn-sm close  remove-collection-widget mt-4   bgc-h-danger-l2 radius-round ">
				<span aria-hidden="true">×</span>

			</button>
		</div>
	</div>
{% endmacro %}

{% macro displayContent(coAuthor) %}
	{# {{form_row(vitalSignTestResult)}} #}

	<div class="col-md-1">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">Title</label>
			{{form_widget(coAuthor.title)}}

		</div>
	</div>
	<div class="col-md-3">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">Name of CO-PI</label>
		<br>	{{form_widget(coAuthor.researcher)}}

		</div>
	</div>

	<div class="col-md-3">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">Department</label>
			<br>
			{{form_widget(coAuthor.department)}}

		</div>
	</div>
 

	<div class="col-md-2">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">Role</label>
			<br>{{form_widget(coAuthor.role)}}

		</div>
	</div>

	<div class="col-md-2">
		<div class="form-group">

			<button type="button" class=" btn btn-danger btn-sm close  remove-collection-widget mt-4   bgc-h-danger-l2 radius-round ">
				<span aria-hidden="true">×</span>

			</button>
		</div>
	</div>
{% endmacro %}
{% block body %}



<div class="row">
	<div class="col-sm-12">
		<div class="card">
			<div class="card-header">
				<h4 class="card-title">Response to call:
					Submission</h4>
			 <button class="btn btn-outline-primary" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight" aria-controls="offcanvasRight">Help</button>
			</div>
			<!--end card-header-->
			<div class="card-body">
				{# add new co athor #}
								  
<div class="modal fade bd-example-modal-lg" id="exampleModalLarge" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
                                        <div class="modal-dialog modal-lg" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h6 class="modal-title m-0" id="myLargeModalLabel">New user 
                                                    
                                                         
                                                         <a href="#" class="avatar-box thumb-xxs align-self-center">
										<span class="avatar-title bg-soft-info rounded-circle font-13 font-weight-normal">
                                                         {# {{ collaborative_research_project.projectAttachments|length }} #}
										</span>
									</a>
                                    </h6>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div><!--end modal-header-->
                                                <div class="modal-body">
                                                    <div class="row">
                                                 
                                                        <div class="col-lg-12 align-self-center">
                                                        <div class="card">
                                                        <div class="card-header">
                                                     New user   </div><!--end col-->                                                            

                                                        <div class="card-body">
     {% if   new ==0 %}
		
    {{ form_start(userform) }}
    {{ form_widget(userform) }}
    <button class="btn btn-info">{{ button_label|default('Register') }}</button>
{{ form_end(userform) }}
	{% else %}

	{% endif %}

                                                        </div><!--end col-->                                                            
                                                        </div><!--end col-->                                                            
                                                        </div><!--end col-->                                                            
                                                    </div><!--end row-->
                                                    
                                                </div><!--end modal-body-->
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-soft-secondary btn-sm" data-bs-dismiss="modal">Close</button>
                                                </div><!--end modal-footer-->
                                            </div><!--end modal-content-->
                                        </div><!--end modal-dialog-->
                                    </div><!--end modal-->
    
								{# add new co athor #}

				{{ form_start(submissionform,{ "attr":{"id":"form-horizontal", "class":""}}) }}
{# {{ form_start(form, {'attr': {'id': 'Form'}}) }} #}
			
			
			{% if form_errors(submissionform) %}
								{% do submission.setStep(1) %}
							{% endif %}
							<div class="col-md-12">
								{{ form_errors(submissionform) }}
							</div>

				<h3>Get started
				</h3>
				<fieldset>
					<div class="row">
						<div class="p-3 mt-10 ">
						<div class="p-3 mt-20 ">
						
						{{ call.guidelines | raw }}
						</div>
						</div>
						<div class="p-3">
							<div class="form-check">
							{# <h1 class='form-control'> #}
							<div class="form-checkgroup">
							
										<h2 class="font-24 text-primary corm-check   d-block mt-2"> 
							 
							 {{ form_widget(submissionform.agree_to_the_terms) }}  
	
							</div>
							</div>
						</div>

						{# ? #}


						{# <div class="accordion" id="accordionExample">
							<div class="accordion-item">
								<h5 class="accordion-header m-0" id="headingOne">
									<button class="accordion-button fw-semibold collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
										Profile
									</button>
								</h5>
								<div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordionExample" style="">
									<div class="accordion-body"></div>
								</div>
							</div>

							 
						</div> #}

					</fieldset>
					<h3>Research details</h3>
					<fieldset>
						<div class="row">
							
							<div class="col-md-8">


								<div class="form-material">
									<label class="form-label mt-3 mb-1">Title<span class='text-danger'>*</span>
									</label>

									{{ form_widget(submissionform.title,{'attr':{'class':'form-control'}}) }}
<br>
									<label class="form-label mt-3 mb-1">Short Title
									{# <span class='text-danger'>*</span> #}
									</label>


									{{ form_widget(submissionform.shortTitle,{'attr':{'class':'form-control'}}) }}
<br>
	
	<label for="txtLastNameBilling" class="form-label mt-3 mb-1">Subtitle</label>
 {{ form_widget(submissionform.sub_title,{'attr':{'class':'form-control'}}) }}
<br>

	<label for="txtLastNameBilling" class="form-label mt-3 mb-1">College<span class='text-danger'>*</span></label>


									{{ form_widget(submissionform.college,{'attr':{'class':'form-control'}}) }}
<br>

	<label for="txtLastNameBilling" class="form-label mt-3 mb-1">Funding Scheme<span class='text-danger'>*</span></label>


									{{ form_widget(submissionform.fundingScheme,{'attr':{'class':'form-control'}}) }}
<br>

									<label class="form-label mt-3 mb-1">General objective<span class='text-danger'>*</span>
									</label>
									<br>
									{{ form_widget(submissionform.GeneralObjective,{'attr':{'class':'form-control'}}) }}
<br>

									<label class="form-label mt-3 mb-1">Specific Objectives
										{# <small>Minimum of 3</small> #}
										<span class='text-danger'>*</span>
									</label><br>


									{# widget for specific objective #}

									<button type="button" class="btn btn-primary add-another-collection-widget btn btn-sm btn-bd-primary float-right " data-list-selector="#objective-fields-list">
										<span aria-hidden="true">+</span>
										Add specific objective
									</button>
									<ul id="objective-fields-list" class="m-t-5" data-prototype="{{_self.displayObjective(submissionform.specificObjectives.vars.prototype)|e }}" data-widget-tags="{{ '<div class="row "></div>'|e }}" data-widget-counter="{{ submissionform.specificObjectives|length }}">
										{% for objective in submissionform.specificObjectives %}
											<div class="row ">
												{{ _self.displayObjective(objective) }}
											</div>
										{% endfor %}
									</ul>
									{#     specific objective #}


								
<br>
									{# <div class="form-group row col-12"> #}
									<label for="txtLastNameBilling" class="form-label mt-3 mb-1"> Executive Summary / Abstract</label>
	 
									{{ form_widget(submissionform.abstract,{'attr':{'class':'form-control'}}) }}
<br>
 										{{ submissionform.vars.value.abstract }}

									{# </div><!--end form-group--> #}

									<label class="form-label mt-3 mb-1">Keywords</label>
	 
									{{ form_widget(submissionform.keywords,{'attr':{'class':'form-control'}}) }}
<br>
									<label class="form-label mt-3 mb-1">Thematic area:</label>
	<span class='text-danger'>*</span>
									{{ form_widget(submissionform.thematic_area,{'attr':{'class':'form-control'}}) }}
<br>

									<label class="form-label mt-3 mb-1">Background and rationale:
									</label>
	<span class='text-danger'>*</span>
									{{ form_widget(submissionform.background_and_rationale,{'attr':{'class':'form-control'}}) }}
<br>
									<label class="form-label mt-3 mb-1">Methodology:
									</label>
	<span class='text-danger'>*</span>
									{{ form_widget(submissionform.methodology,{'attr':{'class':'form-control'}}) }}

								<br>	<label class="form-label mt-3 mb-1">Research outcome/ Output:
									</label>
	<span class='text-danger'>*</span>
									{{ form_widget(submissionform.research_outcome,{'attr':{'class':'form-control'}}) }}
<br>
									<label class="form-label mt-3 mb-1">References:
									</label>
	<span class='text-danger'>*</span>

									{{ form_widget(submissionform.reference,{'attr':{'class':'form-control'}}) }}
<br>

								</div>

							</div>
							<!--end col-->
						</div>
						<!--end row-->


					</fieldset>
					<!--end fieldset-->

					<h3>Research Members</h3>
					<fieldset>
						<div class="row">
							<div class="col-12">

								<button type="button" class="btn btn-primary add-another-collection-widget btn btn-sm btn-bd-primary float-right " data-list-selector="#contact-fields-list">
									<span aria-hidden="true">+</span>
									Add Research members
								</button>

							
								&nbsp;&nbsp; 
								&nbsp;&nbsp; 
								&nbsp;&nbsp; 
								&nbsp;&nbsp; 
								<span class="small text-warning">
								If and only if there is no user  under the [Name of CO-PI] dropdown, then add a user here</span>
								<button type="button" class="btn btn-outline-warning btn-sm" data-bs-toggle="modal" data-bs-target="#exampleModalLarge">
                                                       Add new user
                                                        </button>
												<hr class="hr-dashed my-4">

								<ul id="contact-fields-list" class="m-t-5" data-prototype="{{_self.displayContent(submissionform.coAuthors.vars.prototype)|e }}" data-widget-tags="{{ '<div class="row "></div>'|e }}" data-widget-counter="{{ submissionform.coAuthors|length }}">
									{% for coAuthor in submissionform.coAuthors %}
										<div class="row ">
											{{ _self.displayContent(coAuthor) }}
										</div>
									{% endfor %}
								</ul>


							</div>
							<!--end row-->
						</div>
					</fieldset>
					<!--end fieldset-->

					<h3>Action plan</h3>
					<fieldset>
						<div class="row">
							{% if form_errors(submissionform.submissionBudgets) %}
								{% do submission.setStep(3) %}
							{% endif %}
							<div class="col-md-12">
								{{form_errors(submissionform.submissionBudgets)}}
								
							</div>

							<div class="col-md-12">
								
										<h4 class="font-20 fw-bold d-block mt-2"> 
								Add Budget Expense and Time schedules </h4>
								
								 
							</div>

							<div class="col-12">
								<h4> Budget  </h4>
								<button type="button" class="btn btn-primary add-another-collection-widget btn btn-sm btn-bd-primary float-right " data-list-selector="#budget-fields-list">
									<span aria-hidden="true">+</span>
									Add Budget Expense
								</button>
							<p class="small text-warning">	Each cost of the expenses will be multiplied by their quantity!
							</p>
								<ul id="budget-fields-list" class="m-t-5" data-prototype="{{_self.displayBudget(submissionform.submissionBudgets.vars.prototype)|e }}" data-widget-tags="{{ '<div class="row "></div>'|e }}" data-widget-counter="{{ submissionform.submissionBudgets|length }}">
									{% for budget in submissionform.submissionBudgets %}
										<div class="row ">
											{{ _self.displayBudget(budget) }}
										</div>
									{% endfor %}
								</ul>

							</div>
							<!--end row-->
						</div>
						<div class="row">

							<div class="col-md-12">
								{{form_errors(submissionform.researchTimeTables)}}
							</div>
							

							<div class="col-12">
								<h4>
									Time schedules   </h4>
								<button type="button" class="btn btn-primary add-another-collection-widget btn btn-sm btn-bd-primary float-right " data-list-selector="#research-schedule-list">
									<span aria-hidden="true">+</span>
									Add task schedule
								</button>
								<ul id="research-schedule-list" class="m-t-5" data-prototype="{{_self.researchTime(submissionform.researchTimeTables.vars.prototype)|e }}" data-widget-tags="{{ '<div class="row "></div>'|e }}" data-widget-counter="{{ submissionform.researchTimeTables|length }}">
									{% for researchTimeTable in submissionform.researchTimeTables %}
										<div class="row ">
											{{ _self.researchTime(researchTimeTable) }}
										</div>
									{% endfor %}
								</ul>

							</div>
				 
 
						</div>
					

					</fieldset>
					<!--end fieldset-->

					<h3>Attachement</h3>
					<fieldset>
						<div class="row">
							{% if form_errors(submissionform.submissionAttachements) or form_errors(submissionform.proposalFile) %}
								{% do submission.setStep(4) %}
							{% endif %}
							<div class="col-md-12">
								{{form_errors(submissionform.submissionAttachements)}}
								{{form_errors(submissionform.proposalFile)}}
							</div>
							
							<div class="col-md-12">
							
							<div class="card">
                                <div class="card-header">
                                    <h4 class="card-title">Upload all your attachements   </h4>
                                    <p class="text-muted mb-0">
                                    </p>
                                </div><!--end card-header-->
                                <div class="card-body">
								Upload your concept note here.
                                    <div class="">
                                        {# <label class="input-group-text" for="inputGroupFile01">Upload</label> #}
                                             {% if submission.proposal %}
			<div class="row "> 
							<div class="col-md-4">
			
													
								{# {{form_label(submissionform.proposalFile.children.file)}}  #}
								{{form_widget(submissionform.proposalFile.children.file)}} 
												<br>
													
														</div> 
							<div class="col-md-6">
			<a href="{{ asset('uploads/submission/' ~ submission.proposal ) }}" class="btn btn-xs btn-outline-primary">Download Coept note</a>
														
														</div> 

 							{% else %}
								{{form_widget(submissionform.proposalFile,{"attr":{"required":true}})}}
								
							{% endif %}
                                      </div>
			<br>

<button type="button" class="btn btn-primary m-2 add-another-collection-widget btn btn-sm btn-bd-primary float-right " data-list-selector="#attachement-fields-list">
									<span aria-hidden="true">+</span>
								Add additional Attachement 
								</button>
					<div class="row "> 
							{# <div class="col-md-4"> #}
			
								<ul id="attachement-fields-list" class="m-t-5" data-prototype="{{_self.displayAttachement(submissionform.submissionAttachements.vars.prototype)|e }}" data-widget-tags="{{ '<div class="row "></div>'|e }}" data-widget-counter="{{ submissionform.submissionAttachements|length }}">
										<div class="col-md-12 ">
									
									{% for attachement in submissionform.submissionAttachements %}
										<div class="card ">
										<div class="card-body ">

											{{ _self.displayAttachement2(attachement) }}
										</div>
										</div>
									{% endfor %}
										</div>

								</ul>
                            {# </div> #}
                            </div>
                            </div>

							</div>
							<div class="col-12">
								
								{# {{form_widget(submissionform.submissionAttachements)}} #}
								{{form_widget(submissionform.step)}}
								{{form_widget(submissionform._token,{'attr':{'hidden':true}})}}
							</div>
							<!--end row-->
						</div>
						<!--end row-->
					</fieldset>
					<!--end fieldset-->

					<h3>Confirm submission</h3>
					<fieldset>

						<div class="row">
							<div class="card">
								<div class="card-body">

									<div class="post-title">
										<div class="row">

											<div class="col-auto"> 
											
										 
											</div>
											<!--end col-->
										</div>
										<!--end row-->

										<h5 class="font-20 fw-bold d-block mt-2">Title:</h5>
										<h5 class="font-20 fw-bold d-block mt-3 mb-4 ml-2"> {{ submission.title }}</h5>

<h3 class="font-20 fw-bold d-block mt-2">Short title:</h3>

	<span class="font-20   d-block mt-2">
 										{# {{ submissionform.vars.value.title }}
 										{{ submissionform.vars.value.abstract }}
 										{{ submissionform.vars.value.shortTitle }} #}

											{{ submission.shortTitle ? submission.shortTitle : "no short title"  }}</span>
 
<h3 class="font-20 fw-bold d-block mt-2">Subtitle:</h3>

	<span class="font-20   d-block mt-2">
 											{{ submission.subtitle ? submission.subtitle : "no subtitle"  }}</span>
 
<h3 class="font-20 fw-bold d-block mt-2">Executive summary/ Abstract:</h3>
										<p class="font-15 mt-4">
											{{ submission.abstract ? submission.abstract |raw: "no executive summary" }}
 </p> 
<h3 class="font-20 fw-bold d-block mt-2">Submission keywords</h3>

<div class="card-body pt-0">
 		 
 
									{% for row in submission.keywords |split(',') %}
										<span class="badge bg-soft-dark px-3 py-2 fw-semibold">{{row}}</span>

									{% else %}
										<span class="badge bg-soft-dark px-3 py-2 fw-semibold">No keywords</span>

									{% endfor %}


								</div>

<h3 class="font-20 fw-bold d-block mt-2">Funding Scheme:</h3>
										<p class="font-15 mt-4">
										{% if submission.fundingScheme %}
<span class="badge bg-soft-{{submission.fundingScheme.acronymColor}}">	{{ submission.fundingScheme ? submission.fundingScheme |raw: "no funding Scheme" }}</span>

										{% endif %}
 </p> 
<h3 class="font-20 fw-bold d-block mt-2">College:</h3>
										<p class="font-15 mt-4">
											{{ submission.college ? submission.college |raw: "no college" }}
 </p> 

										<h5 class="font-20 fw-bold d-block mt-2">General objective:</h5>
										<p>
											{{ submission.GeneralObjective }}
										</p>
										<h5 class="font-20 fw-bold d-block mt-2">Specific Objectives:</h5>

										<ul class="list-unstyled mb-0 row">
											{% for objective in submission.specificObjectives %}
												<li class="col-12 my-1 p-1 list-unstyled">
													 
														{{ objective.objective}}
													 

												</li>
											{% endfor %}

										</ul>


									
									</div>
								</div>
								
							</div>



										

									<div class="col-md-12">
								<div class="card">
									<div class="card-header">
										<div class="row align-items-center">
											 
<h3>Research methodology:</h3>
										<p class="font-15 mt-4">
											{{ submission.Methodology ? submission.Methodology |raw: "no   methodology" }}

										</p>


										<h3>
											Background And Rationale:</h3>
										<p class="font-15 mt-4">
											{{ submission.BackgroundAndRationale ? submission.BackgroundAndRationale |raw: "no   Background And Rationale" }}

										</p>

										<h3 class="font-20 fw-bold d-block mt-2">Research outcome:</h3>
										<p class="font-15 mt-4">
											{{ submission.researchOutcome ? submission.researchOutcome |raw: "no research outcome" }}
 </p> 
										<h3 class="font-20 fw-bold d-block mt-2">References:</h3>
										<p class="font-15 mt-4">
											{{ submission.reference ? submission.reference |raw: "no references" }}
 </p> 

										</div>
										<!--end row-->
									</div>
									</div>
									</div>

							<div class="col-md-12">
								<div class="card">
									<div class="card-header">
										<div class="row align-items-center">
											<div class="col">
												<h4 class="card-title">Attachments</h4>
											</div>
											<!--end col-->

										</div>
										<!--end row-->
									</div>
									<!--end card-header-->
									<div class="card-body">
										<ul class="list-group custom-list-group">
											<li class="list-group-item align-items-center d-flex justify-content-between">
													<div class="media">
														<span class="me-3 align-self-center rounded fa fa-file-pdf"></span>
														<div class="media-body align-self-center">
															<h6 class="m-0">Concept note/ Proposal file</h6>
															<a href="{{ asset('uploads/submission/' ~ submission.proposal ) }}" class="font-12 text-primary">Download</a>
														</div>
														<!--end media body-->
													</div>
													<div class="align-self-center">
														<span class="text-muted mb-n2"> </span>
														<div class="apexchart-wrapper w-30 align-self-center">
															<div id="dash_spark_1" class="chart-gutters"></div>
														</div>
													</div>
												</li>
											{% for attachment in submission.submissionAttachements %}

												<li class="list-group-item align-items-center d-flex justify-content-between">
													<div class="media">
														<span class="me-3 align-self-center rounded fa fa-file-pdf"></span>
														<div class="media-body align-self-center">
															<h6 class="m-0">{{ attachment.name}}</h6>
															<a href="{{ asset('uploads/submission/' ~ attachment.file ) }}" class="font-12 text-primary">Download</a>
														</div>
														<!--end media body-->
													</div>
													<div class="align-self-center">
														<span class="text-muted mb-n2"> </span>
														<div class="apexchart-wrapper w-30 align-self-center">
															<div id="dash_spark_1" class="chart-gutters">x</div>
														</div>
													</div>
												</li>

											{% endfor %}

										</ul>
									</div>
									<!--end card-body-->
								</div>
								<!--end card-->
							</div>
							<div class="col-md-12">

								<div class="card">
									<div class="card-header">
										<div class="row align-items-center">
											<div class="col">
												<h4 class="card-title">Research Members</h4>
											</div> 
										</div>
										<!--end row-->
									</div>
									<!--end card-header-->
									<div class="card-body border-bottom-dashed">
										<ul class="list-unstyled mb-0 row">
											{% for author in submission.coAuthors %}
												<li class="col-5 my-1 p-3 list-unstyled">
													<div
														class="row ml-2">
														{# <div class="col-auto">
																																																																																																                                                                    <img src="assets/images/users/user-2.jpg" alt="" class="thumb-md rounded-circle">
																																																																																																                                                                </div><!--end col--> #}
														<div class="col">
															<div class="comment-body ms-n2 bg-light-alt p-3">
																<div class="row">
																	<div class="col">
																		<p class="text-dark fw-semibold mb-2">{{ author.name}}</p>
																	</div>
																	<!--end col-->
																	<div class="col-auto">
																		<span class="text-muted">
																			<i class="fas fa-user me-1"></i>
																			{{ loop.index }}</span>
																	</div>
																	<!--end col-->
																</div>
																<!--end row-->
																<p>

{% if author.researcher and author.researcher.userInfo   %}

{% if author.researcher.userInfo.image   %}
																							<img src="{{ asset('files/profile_pictures/'~ author.researcher.userInfo.image ) }}" class="d-block mx-auto rounded-circle thumb-md" alt="profile">
																						{% else %}
																							<img src="{{ asset('/img/defaultuser.png') }}" class="d-block mx-auto rounded-circle thumb-md" alt="profile">
																						{% endif %}
																						
																						{% endif %}


																	<h4 >
																	
{% if author.researcher   %}


																	{{ author.researcher.userInfo}}
																						{% endif %}
																	
																	</h4>
																</p>
																<p>
																Department:	{{ author.department}}
																</p>
																<p>
																Role:	{{ author.role}}
																</p>

															</div>
														</div>
														<!--end col-->
													</div>
													<!--end row-->

												</li>
											{% endfor %}

										</ul>
									</div>
								</div>

								{# <h4>Action plan :
								</h4> #}

							</div>
							<!--end col-->
						</div>
						<!--end col-->

						<div class="col-12">
							<div class="table-responsive">
								{% if submission.researchTimeTables|length >0 %}

									<h4>Time table:
									</h4>

									<table class="table table-bordered">

										<thead>
											<tr class="bg-gray-dark">
												<th>Task</th>

												<th>Date Start</th>

												<th>Date End</th>
												<th>Remark</th>

											</tr>
										</thead>
										<tbody>
											{% for schedule in submission.researchTimeTables %}


												<tr>
													<td>{{ schedule.task }}</td>


													<td>
														{{ schedule.DateStart|date('d M Y ') }}
													</td>

													<td>
														{{ schedule.DateEnd|date('d M Y') }}

													</td>
													<td>{{ schedule.remark }}</td>


												</tr>
												{% else %}

											{% endfor %}


										</tbody>
									</table>
									{% else %}
								{% endif %}

							</div>
						</div>
 
{% if submission.actionplan|length >0  %}  
						<div class="col-12">
							<div class="table-responsive">
								<h4>Action plan :</h4>
								{{  submission.actionplan |raw }}
</div>
</div>
 	{% endif %}

{% if submission.submissionBudgets|length >0  %}

						<div class="col-12">
							<div class="table-responsive">
								<h4>Budget breakdown :</h4>

								<table id="datatable" class="table table-bordered">
									<thead>
										<tr class="bg-gray-dark">
											<th>Description</th>
											<th>Expense cost </th>
											<th>Total cost</th>
											<th>Quantity</th>
											<th>Total</th> 
										</tr>
									</thead>
									<tbody>
										{% set total = 0 %}
										{% for budget in submission.submissionBudgets %}


											<tr>
												<td>
													{{ budget.description }}
												</td>
												<td>{{ budget.category }}</td>
												<td>{{ budget.cost }}</td>
												<td>{{ budget.quantity }}</td>

												<td>
													{{ budget.cost * budget.quantity }}
												</td>
												{% set total = total + (budget.cost * budget.quantity)  %}

											</tr>
											{% else %}

										{% endfor %}
										<tr class="bg-black text-white">
											<th colspan="3" class="border-0"></th>
											<td class="border-0 font-14">
												<b>Total</b>
											</td>
											<td class="border-0 font-14">
												<b>{{ total }}
													ETB</b>
											</td>
										</tr>

									</tbody>
								</table>
							</div>
						</div>
					</div>
					<!--end row-->
{% endif %}


				</fieldset>
				<!--end fieldset-->

				{{ form_end(submissionform,{'render_rest':false}) }}
				<!--end form-->
			</div>
			<!--end card-body-->
		</div>
		<!--end card-->
	</div><!--end col--></div>
	
	{% endblock %}
{% block script %}
	<script src="{{ asset('plugins/jquery.validate.min.js')}}">
	</script>
	<script src="{{ asset('plugins/jquery-steps/jquery.steps.min.js')}}"></script>
	<script src="{{ asset('plugins/select2/select2.min.js')}}"></script>

	{#<script src="{{ asset('assets/pages/jquery.form-wizard.init.js')}}"></script> #}
	<script>
		jQuery(document).ready(function () {

$(document).on('click', '.remove-collection-widget', function (e) {
var row=$(this).closest('.row')

	if($(this).attr("data-limit") == 1){
		if($(this).closest('ul').children('div').length == 1){
	$(this).closest('ul').find('.remove-collection-widget').parent().parent().remove()

			
		}
		else if($(this).closest('ul').children('div').length == 2){
			var ul=$(this).closest('ul');
			$(row).fadeOut().remove();
			$(ul).find('.remove-collection-widget').parent().parent().remove()



		}else 
$(row).fadeOut().remove();

	}else {

$(row).fadeOut().remove();
	}

$(".select2").select2();
																																																																																																																		

});
$(document).on('click', '.add-another-collection-widget', function (e) {
$(".select2").select2();

var list = jQuery(jQuery(this).attr('data-list-selector'));

var counter = list.data('widget-counter') || list.children().length;
var newWidget = list.attr('data-prototype');
newWidget = newWidget.replace(/__name__/g, counter);
counter++;
list.data('widget-counter', counter);
var newElem = jQuery(list.attr('data-widget-tags')).html(newWidget);
newElem.appendTo(list);
$(".select").select2("destroy").select2();
});
});


var form = $("#form-horizontal");


$("#form-horizontal").steps({
headerTag: "h3",
bodyTag: "fieldset",
transitionEffect: "slideLeft",
onStepChanging: function (event, currentIndex, newIndex) { // Allways allow previous action even if the current form is not valid!
if (currentIndex > newIndex) {
return true;
}


// Needed in some cases if the user went back (clean up)
if (currentIndex < newIndex) { // To remove error styles
form.find(".body:eq(" + newIndex + ") label.error").remove();
form.find(".body:eq(" + newIndex + ") .error").removeClass("error");
}

form.validate().settings.ignore = ":disabled,:hidden";
return form.valid();
},
onStepChanged: function (event, currentIndex, priorIndex) {


if ({{ submission.step }} < currentIndex) {
$("#submission_step").val(currentIndex)
if (currentIndex == 2) 
form.submit();



}
if(currentIndex == 3){

	if($("#research-schedule-list div").length < 1){
	$("#research-schedule-list").siblings('.add-another-collection-widget').click()
	$("#research-schedule-list").find('.remove-collection-widget').parent().parent().remove()
	}
	if($("#budget-fields-list div").length < 1){
	$("#budget-fields-list").siblings('.add-another-collection-widget').click()
	$("#budget-fields-list").find('.remove-collection-widget').parent().parent().remove()

	}
}
},
onFinishing: function (event, currentIndex) {
form.validate().settings.ignore = ":disabled";
return form.valid();
},
onFinished: function (event, currentIndex) {
$("#submission_step").val(10)
form.submit();
}
}).validate({
errorPlacement: function errorPlacement(error, element) {
element.after(error);
},
rules: {
"submission[title]": {
required: true,
minlength: 25, 

},
"#submission_agree_to_the_terms_0": {
required: true
}
, 

},
messages: {
"submission[agree_to_the_terms]": {
required: "You need to agree with the Terms and Conditions before you continue."

}
}
});
// $("#form-horizontal-t-{{ submission.step  }}").get(0).click();
$.fn.steps.setStep = function (step) {
var currentIndex = $(this).steps('getCurrentIndex');
for (var i = 0; i < Math.abs(step - currentIndex); i++) {
if (step > currentIndex) {
$(this).steps('next');
} else {
$(this).steps('previous');
}
}
};
$("#form-horizontal").steps("setStep", {{ submission.step }});
var $input = $('<button class="btn btn-success" type="submit">Save and submit</button>');

$input.appendTo($('ul[aria-label=Pagination]'));
	</script>
	<script>

		$(function () {
$(".select2").select2();

})

window.onload = function() {
  init();
$(".select2").select2();
};

	</script>
{% if new==1 %}
	 {% set url ="{{path('submission_firststepold',{'uidentifier':callForProposal.uidentifier})}}"%}

 {% elseif   new == 0 %}
 
	 {% set url ="{{path('editsubmission',{'uidentifier':submission.uidentifier})}}"%}
{% endif %}
  <script>
setInterval(saveData, 5000);
function saveData(){
 
 //var postid = $('#submission_status[name]').val(); 
 var postid = $('#title').val(); 

 if(postid != ''  ){
  
  $.ajax({
   url: "{{path('editsubmission',{'uidentifier':submission.uidentifier})}}",
   //url: "{{url}}",
   type: 'post', 
   data: $('#form-horizontal').serialize(),
   success: function(response){
    $('#postid').val(response);
   } 
  });
 }
 
}

</script>
{% endblock %}
